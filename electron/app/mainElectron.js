"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var appWindow,splashWindow,electron_1=require("electron"),main_1=require("@electron/remote/main"),setupEvents_1=require("./setupEvents"),node_notifier_1=require("node-notifier"),isDev=require("electron-is-dev"),serve=require("electron-serve"),path=require("path"),url=require("url"),setupEvents=new setupEvents_1.SetupEvents,loadURL=serve({directory:path.join(__dirname,"./app/"),scheme:"app"});function init(){if((0,main_1.initialize)(),setupEvents.handleSquirrelEvent())return!1;(splashWindow=new electron_1.BrowserWindow({width:260,minWidth:260,maxWidth:260,height:360,minHeight:360,maxHeight:360,darkTheme:!0,frame:!1,titleBarStyle:"hidden",alwaysOnTop:!0,fullscreenable:!1,maximizable:!1,minimizable:!1,resizable:!0,movable:!1,transparent:!1,webPreferences:{devTools:isDev}})).loadURL(url.pathToFileURL(path.join(__dirname,"./splash/index.html")).href.toLowerCase()),splashWindow.webContents.once("dom-ready",function(){appWindow=new electron_1.BrowserWindow({fullscreenable:!1,minHeight:619,minWidth:886,darkTheme:!0,frame:!1,titleBarStyle:"hidden",show:!1,webPreferences:{nodeIntegration:!0,devTools:isDev,contextIsolation:!1,webSecurity:!1,nativeWindowOpen:!0}}),loadURL(appWindow),appWindow.setMenuBarVisibility(!1),appWindow.webContents.setWindowOpenHandler(function(){return{action:"allow",overrideBrowserWindowOptions:{fullscreenable:!1,titleBarStyle:"default",autoHideMenuBar:!0,frame:!0,darkTheme:!0,backgroundColor:"#FFFFFF",webPreferences:{nodeIntegration:!0,contextIsolation:!1,devTools:isDev,preload:path.join(__dirname,"windowOpenPreload.js")}}}}),appWindow.webContents.once("dom-ready",function(){return setTimeout(function(){splashWindow.hide(),splashWindow.destroy(),appWindow.show()},2048)}),appWindow.on("maximize",function(){return appWindow.webContents.send("window-maximize","true")}),appWindow.on("unmaximize",function(){return appWindow.webContents.send("window-restore","true")}),appWindow.on("resize",function(){return appWindow.webContents.send("window-resize","true")}),(0,main_1.enable)(appWindow.webContents);appWindow.webContents.session.webRequest.onBeforeRequest({urls:["app://www.chatbro.com/*","app://chatbro.com/*","app://*.chatbro.com/*","http://www.chatbro.com/*","http://chatbro.com/*","http://*.chatbro.com/*"]},function(e,n){-1!==e.url.indexOf("app://")&&(e.url="https".concat(e.url.replace("app://","://"))),-1!==e.url.indexOf("http")&&-1===e.url.indexOf("https")&&(e.url=e.url.replace("http","https")),n({cancel:!1,redirectURL:e.url})})}),electron_1.ipcMain.on("reload",function(){appWindow.destroy(),electron_1.app.relaunch()}),electron_1.ipcMain.on("notify",function(e,n){(0,node_notifier_1.notify)({appID:"Henaojara",title:void 0!==n.title?n.title:void 0,message:n.body,sound:void 0===n.sound||n.sound,icon:void 0!==n.icon?n.icon:path.join(__dirname,"./icons/64x64.png"),wait:!1})}),electron_1.ipcMain.on("window-minimize",function(e){return electron_1.BrowserWindow.fromWebContents(e.sender).minimize()}),electron_1.ipcMain.on("window-maximize",function(e){e=electron_1.BrowserWindow.fromWebContents(e.sender);e.isMaximized()?e.unmaximize():e.maximize()}),electron_1.ipcMain.on("window-close",function(e){return electron_1.BrowserWindow.fromWebContents(e.sender).close()}),electron_1.ipcMain.on("window-is-maximized",function(e){return e.returnValue=electron_1.BrowserWindow.fromWebContents(e.sender).isMaximized()})}electron_1.app.setAppUserModelId("Henaojara"),electron_1.app.on("ready",init),electron_1.app.on("activate",function(){return null===appWindow&&init()});